<?php

/**
 * Implements hook_tzsms_send.
 * Logs sms sending to the statistics database
 */
function tzstats_tzsms_send($type, $phonenbr) {
  global $user;
  $record = array(
    'uid' => $user->uid,
    'timestamp' => time(),
    'sms_type' => $type,
    'destination' => $phonenbr
  );
  drupal_write_record('tzstats_sms', $record);
}

function tzstats_synchronized_multiple_users($module, $count, $successful, $before, $after) {
  watchdog('tzstats', 'Synchronized !successful/!count users in !seconds seconds using @module',
    array(
      '@module' => $module,
      '!successful' => $successful,
      '!count' => $count,
      '!seconds' => ($after - $before),
    )
  );
  $record = array(
    'module' => $module,
    'count' => $count,
    'successful' => $successful,
    'seconds' => ($after - $before),
    'timestamp' => time(),
  );
  drupal_write_record('tzstats_sync', $record);
}


/**
 * Implementation of hook_views_api.
 * The rest of the hooks are in tzstats.views.inc
 */
function tzstats_views_api() {
  return array(
    'api' => 2,
    'path' => drupal_get_path('module', 'tzstats'),
  );
}

/**
 * Implementation of hook_date_api_fields().
 *
 * Registers the timestamp field so the date can be used by
 * the Date API views date argument and date filter.
 */
function tzstats_date_api_fields($field) {
  if($field == 'tzstats_sync.timestamp') {
    return array(
      // The type of date: DATE_UNIX, DATE_ISO, DATE_DATETIME.
      'sql_type' => DATE_UNIX,
      // Timezone handling options: 'none', 'site', 'date', 'utc'.
      'tz_handling' => 'site',
      // Needed only for dates that use 'date' tz_handling.
      'timezone_field' => '',
      // Needed only for dates that use 'date' tz_handling.
      'offset_field' => '',
      // Array of "table.field" values for related fields that should be
      // loaded automatically in the Views SQL.
      'related_fields' => array(),
      // Granularity of this date field's db data.
      'granularity' => array('year', 'month', 'day', 'hour', 'minute', 'second'),
    );
  }
}